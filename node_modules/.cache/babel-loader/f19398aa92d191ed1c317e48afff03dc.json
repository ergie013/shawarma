{"ast":null,"code":"import _regeneratorRuntime from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/lampp/htdocs/shawarma/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/opt/lampp/htdocs/shawarma/src/components/Mobile/Home/index.js\";\nimport * as firebase from \"firebase/app\";\nimport React, { Component } from \"react\";\nimport Footer from \"../Footer\";\nimport Meta from \"../../helpers/meta\";\nimport Nav from \"../Nav\";\nimport PromoSlider from \"./PromoSlider\";\nimport { Redirect } from \"react-router\";\nimport RestaurantList from \"./RestaurantList\";\nimport { connect } from \"react-redux\";\nimport { getPromoSlides } from \"../../../services/promoSlider/actions\";\nimport messaging from \"../../../init-fcm\";\nimport { saveNotificationToken } from \"../../../services/notification/actions\";\nimport { getSingleLanguageData } from \"../../../services/languages/actions\";\nimport { getUserNotifications } from \"../../../services/alert/actions\";\nimport { Link } from \"react-router-dom\"; // import moment from \"moment\";\n\nvar Home =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Home, _Component);\n\n  function Home() {\n    _classCallCheck(this, Home);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Home).apply(this, arguments));\n  }\n\n  _createClass(Home, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var user, _user, handler;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                user = this.props.user; //if currentLocation doesnt exists in localstorage then redirect the user to firstscreen\n                //else make API calls\n\n                if (localStorage.getItem(\"userSetAddress\") !== null) {\n                  // this.context.router.history.push(\"/search-location\");\n                  // console.log(\"Redirect to search location\");\n                  // return <Redirect to=\"/search-location\" />;\n                  if (localStorage.getItem(\"showPromoSlider\") === \"true\") {\n                    this.props.getPromoSlides();\n                  }\n\n                  _user = this.props.user;\n\n                  if (_user.success) {\n                    this.props.getUserNotifications(_user.data.id, _user.data.auth_token);\n                  }\n                } else {//call to promoSlider API to fetch the slides\n                }\n\n                if (user.success) {\n                  if (localStorage.getItem(\"enablePushNotification\") === \"true\") {\n                    if (firebase.messaging.isSupported()) {\n                      // const today = moment().toDate();\n                      // console.log(\"TODAY\", today);\n                      // const lastSavedNotificationToken = moment(localStorage.getItem(\"lastSavedNotificationToken\"));\n                      // const days = moment(today).diff(lastSavedNotificationToken, \"days\");\n                      // console.log(\"DAYS\", days);\n                      // const callForNotificationToken = isNaN(days) || days >= 5;\n                      // console.log(callForNotificationToken);\n                      // if (callForNotificationToken) {\n                      handler = this.props.saveNotificationToken;\n                      messaging.requestPermission().then(\n                      /*#__PURE__*/\n                      _asyncToGenerator(\n                      /*#__PURE__*/\n                      _regeneratorRuntime.mark(function _callee() {\n                        var push_token;\n                        return _regeneratorRuntime.wrap(function _callee$(_context) {\n                          while (1) {\n                            switch (_context.prev = _context.next) {\n                              case 0:\n                                _context.next = 2;\n                                return messaging.getToken();\n\n                              case 2:\n                                push_token = _context.sent;\n                                handler(push_token, user.data.id, user.data.auth_token); // localStorage.setItem(\"lastSavedNotificationToken\", today);\n\n                              case 4:\n                              case \"end\":\n                                return _context.stop();\n                            }\n                          }\n                        }, _callee, this);\n                      }))).catch(function (err) {\n                        console.log(\"Unable to get permission to notify.\", err);\n                      }); // }\n                    }\n                  }\n                }\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.languages !== nextProps.languages) {\n        if (localStorage.getItem(\"userPreferedLanguage\")) {\n          this.props.getSingleLanguageData(localStorage.getItem(\"userPreferedLanguage\"));\n        } else {\n          if (nextProps.languages.length) {\n            // console.log(\"Fetching Translation Data...\");\n            var id = nextProps.languages.filter(function (lang) {\n              return lang.is_default === 1;\n            })[0].id;\n            this.props.getSingleLanguageData(id);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {// navigator.serviceWorker.removeEventListener(\"message\", message => console.log(message));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (window.innerWidth > 768) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 100\n          },\n          __self: this\n        });\n      }\n\n      if (localStorage.getItem(\"userSetAddress\") === null) {\n        // this.context.router.history.push(\"/search-location\");\n        // console.log(\"Redirect to search location\");\n        return React.createElement(Redirect, {\n          to: \"/search-location\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106\n          },\n          __self: this\n        });\n      }\n\n      var userSetAddress = JSON.parse(localStorage.getItem(\"userSetAddress\"));\n\n      if (Object.keys(userSetAddress).length === 0 && userSetAddress.constructor === Object) {\n        return React.createElement(Redirect, {\n          to: \"/search-location\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 111\n          },\n          __self: this\n        });\n      }\n\n      var _this$props = this.props,\n          history = _this$props.history,\n          user = _this$props.user,\n          promo_slides = _this$props.promo_slides; // console.log(promo_slides.mainSlides.length);\n\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119\n        },\n        __self: this\n      }, React.createElement(Meta, {\n        seotitle: localStorage.getItem(\"seoMetaTitle\"),\n        seodescription: localStorage.getItem(\"seoMetaDescription\"),\n        ogtype: \"website\",\n        ogtitle: localStorage.getItem(\"seoOgTitle\"),\n        ogdescription: localStorage.getItem(\"seoOgDescription\"),\n        ogurl: window.location.href,\n        twittertitle: localStorage.getItem(\"seoTwitterTitle\"),\n        twitterdescription: localStorage.getItem(\"seoTwitterDescription\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"height-100-percent bg-white mb-50\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, React.createElement(Nav, {\n        logo: true,\n        active_nearme: true,\n        disable_back_button: true,\n        history: history,\n        loggedin: user.success,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }), localStorage.getItem(\"showPromoSlider\") === \"true\" && React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, promo_slides && promo_slides.mainSlides && promo_slides.mainSlides.length > 0 && React.createElement(PromoSlider, {\n        slides: promo_slides.mainSlides,\n        size: promo_slides.mainSlides[0][\"promo_slider\"][\"size\"],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      })), localStorage.getItem(\"mockSearchOnHomepage\") === \"true\" && React.createElement(Link, {\n        to: \"explore\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"mock-search-block px-15 pb-10 \".concat(localStorage.getItem(\"showPromoSlider\") === \"false\" ? \"pt-15\" : \"\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"px-15 d-flex justify-content-between\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, localStorage.getItem(\"mockSearchPlaceholder\"))), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"si si-magnifier\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }))))), localStorage.getItem(\"customHomeMessage\") !== \"<p><br></p>\" && localStorage.getItem(\"customHomeMessage\") !== \"null\" && localStorage.getItem(\"customHomeMessage\") !== \"\" && React.createElement(\"div\", {\n        style: {\n          position: \"relative\",\n          background: \"#f8f9fa\"\n        },\n        dangerouslySetInnerHTML: {\n          __html: localStorage.getItem(\"customHomeMessage\")\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }), React.createElement(RestaurantList, {\n        user: user,\n        slides: promo_slides.otherSlides,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), React.createElement(Footer, {\n        active_nearme: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Home;\n}(Component);\n\nHome.contextTypes = {\n  router: function router() {\n    return null;\n  }\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    promo_slides: state.promo_slides.promo_slides,\n    user: state.user.user,\n    locations: state.locations.locations,\n    languages: state.languages.languages\n  };\n};\n\nexport default connect(mapStateToProps, {\n  getPromoSlides: getPromoSlides,\n  saveNotificationToken: saveNotificationToken,\n  getSingleLanguageData: getSingleLanguageData,\n  getUserNotifications: getUserNotifications\n})(Home);","map":{"version":3,"sources":["/opt/lampp/htdocs/shawarma/src/components/Mobile/Home/index.js"],"names":["firebase","React","Component","Footer","Meta","Nav","PromoSlider","Redirect","RestaurantList","connect","getPromoSlides","messaging","saveNotificationToken","getSingleLanguageData","getUserNotifications","Link","Home","user","props","localStorage","getItem","success","data","id","auth_token","isSupported","handler","requestPermission","then","getToken","push_token","catch","err","console","log","nextProps","languages","length","filter","lang","is_default","window","innerWidth","userSetAddress","JSON","parse","Object","keys","constructor","history","promo_slides","location","href","mainSlides","position","background","__html","otherSlides","contextTypes","router","mapStateToProps","state","locations"],"mappings":"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","sourcesContent":["import * as firebase from \"firebase/app\";\r\n\r\nimport React, { Component } from \"react\";\r\n\r\nimport Footer from \"../Footer\";\r\nimport Meta from \"../../helpers/meta\";\r\nimport Nav from \"../Nav\";\r\nimport PromoSlider from \"./PromoSlider\";\r\nimport { Redirect } from \"react-router\";\r\nimport RestaurantList from \"./RestaurantList\";\r\nimport { connect } from \"react-redux\";\r\nimport { getPromoSlides } from \"../../../services/promoSlider/actions\";\r\n\r\nimport messaging from \"../../../init-fcm\";\r\nimport { saveNotificationToken } from \"../../../services/notification/actions\";\r\nimport { getSingleLanguageData } from \"../../../services/languages/actions\";\r\nimport { getUserNotifications } from \"../../../services/alert/actions\";\r\nimport { Link } from \"react-router-dom\";\r\n// import moment from \"moment\";\r\n\r\nclass Home extends Component {\r\n\tstatic contextTypes = {\r\n\t\trouter: () => null,\r\n\t};\r\n\r\n\tasync componentDidMount() {\r\n\t\tconst { user } = this.props;\r\n\r\n\t\t//if currentLocation doesnt exists in localstorage then redirect the user to firstscreen\r\n\t\t//else make API calls\r\n\t\tif (localStorage.getItem(\"userSetAddress\") !== null) {\r\n\t\t\t// this.context.router.history.push(\"/search-location\");\r\n\t\t\t// console.log(\"Redirect to search location\");\r\n\t\t\t// return <Redirect to=\"/search-location\" />;\r\n\t\t\tif (localStorage.getItem(\"showPromoSlider\") === \"true\") {\r\n\t\t\t\tthis.props.getPromoSlides();\r\n\t\t\t}\r\n\r\n\t\t\tconst { user } = this.props;\r\n\r\n\t\t\tif (user.success) {\r\n\t\t\t\tthis.props.getUserNotifications(user.data.id, user.data.auth_token);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//call to promoSlider API to fetch the slides\r\n\t\t}\r\n\r\n\t\tif (user.success) {\r\n\t\t\tif (localStorage.getItem(\"enablePushNotification\") === \"true\") {\r\n\t\t\t\tif (firebase.messaging.isSupported()) {\r\n\t\t\t\t\t// const today = moment().toDate();\r\n\r\n\t\t\t\t\t// console.log(\"TODAY\", today);\r\n\t\t\t\t\t// const lastSavedNotificationToken = moment(localStorage.getItem(\"lastSavedNotificationToken\"));\r\n\t\t\t\t\t// const days = moment(today).diff(lastSavedNotificationToken, \"days\");\r\n\r\n\t\t\t\t\t// console.log(\"DAYS\", days);\r\n\r\n\t\t\t\t\t// const callForNotificationToken = isNaN(days) || days >= 5;\r\n\r\n\t\t\t\t\t// console.log(callForNotificationToken);\r\n\t\t\t\t\t// if (callForNotificationToken) {\r\n\t\t\t\t\tlet handler = this.props.saveNotificationToken;\r\n\t\t\t\t\tmessaging\r\n\t\t\t\t\t\t.requestPermission()\r\n\t\t\t\t\t\t.then(async function() {\r\n\t\t\t\t\t\t\tconst push_token = await messaging.getToken();\r\n\t\t\t\t\t\t\thandler(push_token, user.data.id, user.data.auth_token);\r\n\t\t\t\t\t\t\t// localStorage.setItem(\"lastSavedNotificationToken\", today);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(function(err) {\r\n\t\t\t\t\t\t\tconsole.log(\"Unable to get permission to notify.\", err);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillReceiveProps(nextProps) {\r\n\t\tif (this.props.languages !== nextProps.languages) {\r\n\t\t\tif (localStorage.getItem(\"userPreferedLanguage\")) {\r\n\t\t\t\tthis.props.getSingleLanguageData(localStorage.getItem(\"userPreferedLanguage\"));\r\n\t\t\t} else {\r\n\t\t\t\tif (nextProps.languages.length) {\r\n\t\t\t\t\t// console.log(\"Fetching Translation Data...\");\r\n\t\t\t\t\tconst id = nextProps.languages.filter((lang) => lang.is_default === 1)[0].id;\r\n\t\t\t\t\tthis.props.getSingleLanguageData(id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\t// navigator.serviceWorker.removeEventListener(\"message\", message => console.log(message));\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (window.innerWidth > 768) {\r\n\t\t\treturn <Redirect to=\"/\" />;\r\n\t\t}\r\n\r\n\t\tif (localStorage.getItem(\"userSetAddress\") === null) {\r\n\t\t\t// this.context.router.history.push(\"/search-location\");\r\n\t\t\t// console.log(\"Redirect to search location\");\r\n\t\t\treturn <Redirect to=\"/search-location\" />;\r\n\t\t}\r\n\r\n\t\tconst userSetAddress = JSON.parse(localStorage.getItem(\"userSetAddress\"));\r\n\t\tif (Object.keys(userSetAddress).length === 0 && userSetAddress.constructor === Object) {\r\n\t\t\treturn <Redirect to=\"/search-location\" />;\r\n\t\t}\r\n\r\n\t\tconst { history, user, promo_slides } = this.props;\r\n\r\n\t\t// console.log(promo_slides.mainSlides.length);\r\n\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Meta\r\n\t\t\t\t\tseotitle={localStorage.getItem(\"seoMetaTitle\")}\r\n\t\t\t\t\tseodescription={localStorage.getItem(\"seoMetaDescription\")}\r\n\t\t\t\t\togtype=\"website\"\r\n\t\t\t\t\togtitle={localStorage.getItem(\"seoOgTitle\")}\r\n\t\t\t\t\togdescription={localStorage.getItem(\"seoOgDescription\")}\r\n\t\t\t\t\togurl={window.location.href}\r\n\t\t\t\t\ttwittertitle={localStorage.getItem(\"seoTwitterTitle\")}\r\n\t\t\t\t\ttwitterdescription={localStorage.getItem(\"seoTwitterDescription\")}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t<div className=\"height-100-percent bg-white mb-50\">\r\n\t\t\t\t\t<Nav\r\n\t\t\t\t\t\tlogo={true}\r\n\t\t\t\t\t\tactive_nearme={true}\r\n\t\t\t\t\t\tdisable_back_button={true}\r\n\t\t\t\t\t\thistory={history}\r\n\t\t\t\t\t\tloggedin={user.success}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{/* Passing slides as props to PromoSlider */}\r\n\t\t\t\t\t{localStorage.getItem(\"showPromoSlider\") === \"true\" && (\r\n\t\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t\t{promo_slides && promo_slides.mainSlides && promo_slides.mainSlides.length > 0 && (\r\n\t\t\t\t\t\t\t\t<PromoSlider\r\n\t\t\t\t\t\t\t\t\tslides={promo_slides.mainSlides}\r\n\t\t\t\t\t\t\t\t\tsize={promo_slides.mainSlides[0][\"promo_slider\"][\"size\"]}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{localStorage.getItem(\"mockSearchOnHomepage\") === \"true\" && (\r\n\t\t\t\t\t\t<Link to=\"explore\">\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={`mock-search-block px-15 pb-10 ${\r\n\t\t\t\t\t\t\t\t\tlocalStorage.getItem(\"showPromoSlider\") === \"false\" ? \"pt-15\" : \"\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<div className=\"px-15 d-flex justify-content-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<span>{localStorage.getItem(\"mockSearchPlaceholder\")}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<i className=\"si si-magnifier\" />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{localStorage.getItem(\"customHomeMessage\") !== \"<p><br></p>\" &&\r\n\t\t\t\t\t\tlocalStorage.getItem(\"customHomeMessage\") !== \"null\" &&\r\n\t\t\t\t\t\t(localStorage.getItem(\"customHomeMessage\") !== \"\" && (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\tposition: \"relative\",\r\n\t\t\t\t\t\t\t\t\tbackground: \"#f8f9fa\",\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tdangerouslySetInnerHTML={{\r\n\t\t\t\t\t\t\t\t\t__html: localStorage.getItem(\"customHomeMessage\"),\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t<RestaurantList user={user} slides={promo_slides.otherSlides} />\r\n\t\t\t\t\t<Footer active_nearme={true} />\r\n\t\t\t\t</div>\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tpromo_slides: state.promo_slides.promo_slides,\r\n\tuser: state.user.user,\r\n\tlocations: state.locations.locations,\r\n\tlanguages: state.languages.languages,\r\n});\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n\t{\r\n\t\tgetPromoSlides,\r\n\t\tsaveNotificationToken,\r\n\t\tgetSingleLanguageData,\r\n\t\tgetUserNotifications,\r\n\t}\r\n)(Home);\r\n"]},"metadata":{},"sourceType":"module"}